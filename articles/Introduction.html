<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="motifmw">
<title>Comparing spatial patterns using moving window approach • motifmw</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing spatial patterns using moving window approach">
<meta property="og:description" content="motifmw">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">motifmw</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">Comparing spatial patterns using moving window approach</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Comparing spatial patterns using moving window approach</h1>
                        <h4 data-toc-skip class="author">Jakub
Nowosad</h4>
            
            <h4 data-toc-skip class="date">2024-04-07</h4>
      
      
      <div class="d-none name"><code>Introduction.Rmd</code></div>
    </div>

    
    
<p>The <strong>motifmw</strong> package provides a possibility to
calculate the local spatial pattern signature of a raster dataset using
a moving window approach. The spatial signature is a vector of numbers
that describes the spatial pattern of a raster dataset, which can be
used, for example, to compare the spatial patterns of two raster
datasets. This vignette demonstrates how to use the
<strong>motifmw</strong> together with another package called
<strong>spquery</strong> to compare the spatial patterns of two land
cover raster datasets using a moving window approach.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To reproduce the code in this vignette, you need to install just
three packages: <strong>motifmw</strong>, <strong>spquery</strong>, and
<strong>terra</strong>. The first two packages can be installed from
GitHub using the <code>remotes</code> package, while the
<strong>terra</strong> package can be installed from CRAN.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"nowosad/motifmw"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"nowosad/spquery"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="packages-and-data">Packages and data<a class="anchor" aria-label="anchor" href="#packages-and-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://jakubnowosad.com/motifmw/">motifmw</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spquery</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
<p>The <strong>motifmw</strong> approach is suitable for categorical
raster datasets. Here, we will use two ESA land cover raster datasets:
one from 1992 and the other from 2018. The datasets and their color
tables are available from the Open Science Framework (OSF)
repository.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc92</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"https://osf.io/download/tjzwe/"</span><span class="op">)</span></span>
<span><span class="va">lc18</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"https://osf.io/download/wdzy6/"</span><span class="op">)</span></span>
<span><span class="va">coltb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://osf.io/download/2qd5k/"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/colors.html" class="external-link">coltab</a></span><span class="op">(</span><span class="va">lc92</span><span class="op">)</span> <span class="op">=</span> <span class="va">coltb</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/colors.html" class="external-link">coltab</a></span><span class="op">(</span><span class="va">lc18</span><span class="op">)</span> <span class="op">=</span> <span class="va">coltb</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lc92</span>, <span class="va">lc18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-3-1.png"></p>
<p>For the examples below, we will crop the original data to a smaller
area of 1000 by 1000 cells.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc92</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">lc92</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7e6</span>, <span class="op">-</span><span class="fl">67e5</span>, <span class="op">-</span><span class="fl">13e5</span>, <span class="op">-</span><span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lc18</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">lc18</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7e6</span>, <span class="op">-</span><span class="fl">67e5</span>, <span class="op">-</span><span class="fl">13e5</span>, <span class="op">-</span><span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lc92</span>, <span class="va">lc18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-4-1.png"></p>
<p>This area was mostly covered by the forest (green color) in 1992, but
in 2018, it was mostly covered by agriculture (yellow).</p>
</div>
<div class="section level2">
<h2 id="local-spatial-pattern-signature">Local spatial pattern signature<a class="anchor" aria-label="anchor" href="#local-spatial-pattern-signature"></a>
</h2>
<p>The main function in the <strong>motifmw</strong> package is
<code><a href="../reference/lsp_signature_mw.html">lsp_signature_mw()</a></code>, which calculates the local spatial
pattern signature (called a co-occurrence vector, cove, learn more at <a href="https://jakubnowosad.com/comat/articles/coma.html" class="external-link uri">https://jakubnowosad.com/comat/articles/coma.html</a>) of a
raster dataset using a moving window approach. The function requires two
arguments: <code>x</code> – a raster dataset, and <code>window</code> –
a matrix that defines the shape and size of the moving window.</p>
</div>
<div class="section level2">
<h2 id="square-window">Square window<a class="anchor" aria-label="anchor" href="#square-window"></a>
</h2>
<p>Let’s start with an example using a square window of size 11 by 11
cells, which can be defined with the <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix()</a></code> function.
This means that a spatial signature for each cell will be calculated
based on the 11 by 11 cells around it (5 cells in each direction).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">window_size</span> <span class="op">=</span> <span class="fl">21</span></span>
<span><span class="va">window</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="va">window_size</span>, ncol <span class="op">=</span> <span class="va">window_size</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">window</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-5-1.png"></p>
<p>Next, we calculate the local spatial pattern signature for both land
cover raster datasets using the <code><a href="../reference/lsp_signature_mw.html">lsp_signature_mw()</a></code>
function. This operation may take about a minute as we need to calculate
the spatial signature in the 21 by 21 cells window for each of the
1,000,000 cells in the raster dataset.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The calculation time would increase with the number of
cells in the raster dataset and the size of the window.&lt;/p&gt;"><sup>1</sup></a></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc92s</span> <span class="op">=</span> <span class="fu">motifmw</span><span class="fu">::</span><span class="fu"><a href="../reference/lsp_signature_mw.html">lsp_signature_mw</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lc92</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span>
<span><span class="va">lc18s</span> <span class="op">=</span> <span class="fu">motifmw</span><span class="fu">::</span><span class="fu"><a href="../reference/lsp_signature_mw.html">lsp_signature_mw</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lc18</span>, window <span class="op">=</span> <span class="va">window</span><span class="op">)</span></span></code></pre></div>
<p>The output of the <code><a href="../reference/lsp_signature_mw.html">lsp_signature_mw()</a></code> function in this
case is a raster dataset with 28 layers, where each layer represents a
different part of the spatial signature.</p>
<p>Finally, we can compare the spatial patterns of the two land cover
raster datasets using the <code>spq_compare()</code> function from the
<strong>spquery</strong> package. This function calculates the
Jensen-Shannon divergence between the two spatial signatures, which is a
measure of the similarity between two probability distributions. The
lower the value, the more similar the spatial patterns of the two raster
datasets.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;To be precise, in this case lower the value, the fewer
changes occur between 1992 and 2018.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc_compare</span> <span class="op">=</span> <span class="fu">spq_compare</span><span class="op">(</span><span class="va">lc92s</span>, <span class="va">lc18s</span>, dist_fun <span class="op">=</span> <span class="st">"jensen-shannon"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lc_compare</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-7-1.png"></p>
</div>
<div class="section level2">
<h2 id="circle-window">Circle window<a class="anchor" aria-label="anchor" href="#circle-window"></a>
</h2>
<p>Although the square window is the most common choice, it is not the
best option in all cases: it uses values from the corners of the window,
which are further away from the center cell. An alternative is to use a
circular window, which can be created using the <code><a href="https://rspatial.github.io/terra/reference/focalMat.html" class="external-link">focalMat()</a></code>
function from the <strong>terra</strong> package. Here, we create a
circular window with a radius of 10 cells.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">window2</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/focalMat.html" class="external-link">focalMat</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">window</span><span class="op">)</span>, d <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"circle"</span>, fillNA <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">window2</span><span class="op">[</span><span class="va">window2</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">window2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-8-1.png"></p>
<p>The next steps are the same as before:</p>
<ol style="list-style-type: decimal">
<li>we calculate the local spatial pattern signature for both land cover
raster datasets using the <code><a href="../reference/lsp_signature_mw.html">lsp_signature_mw()</a></code> function</li>
<li>we compare the spatial patterns of the two land cover raster
datasets using the <code>spq_compare()</code> function</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lc92s2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_signature_mw.html">lsp_signature_mw</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lc92</span>, window <span class="op">=</span> <span class="va">window2</span><span class="op">)</span></span>
<span><span class="va">lc18s2</span> <span class="op">=</span> <span class="fu"><a href="../reference/lsp_signature_mw.html">lsp_signature_mw</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lc18</span>, window <span class="op">=</span> <span class="va">window2</span><span class="op">)</span></span>
<span><span class="va">lc_compare2</span> <span class="op">=</span> <span class="fu">spq_compare</span><span class="op">(</span><span class="va">lc92s2</span>, <span class="va">lc18s2</span>, dist_fun <span class="op">=</span> <span class="st">"jensen-shannon"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lc_compare2</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-9-1.png"></p>
<p>The resulting map is similar to the one obtained using the square
window, but some differences can be observed. We can see them better by
plotting the difference between the two maps.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lc_compare</span> <span class="op">-</span> <span class="va">lc_compare2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/unnamed-chunk-10-1.png"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>The <strong>motifmw</strong> package allows calculation of the local
spatial pattern signature of a raster dataset using a moving window
approach. It can be then used to compare changes in spatial patterns
between two raster datasets, as demonstrated in this vignette. This
package can also be used to extract the spatial pattern signature of a
raster dataset for further analysis, such as using machine learning.</p>
<p>The package is experimental, and any comments and suggestions at <a href="https://github.com/Nowosad/motifmw/issues" class="external-link uri">https://github.com/Nowosad/motifmw/issues</a> are
welcome.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
